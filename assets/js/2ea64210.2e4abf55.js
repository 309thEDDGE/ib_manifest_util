"use strict";(self.webpackChunkclassic=self.webpackChunkclassic||[]).push([[893],{3905:(e,n,t)=>{t.d(n,{Zo:()=>s,kt:()=>m});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=o.createContext({}),u=function(e){var n=o.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},s=function(e){var n=u(e.components);return o.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},c=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),c=u(t),m=r,h=c["".concat(p,".").concat(m)]||c[m]||d[m]||a;return t?o.createElement(h,i(i({ref:n},s),{},{components:t})):o.createElement(h,i({ref:n},s))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,i=new Array(a);i[0]=c;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var u=2;u<a;u++)i[u]=t[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}c.displayName="MDXCreateElement"},2038:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>u});var o=t(7462),r=(t(7294),t(3905));const a={sidebar_position:1,sidebar_label:"Updating an Iron Bank Repo"},i="Updating an Iron Bank Repo",l={unversionedId:"user-guide/updating_repos",id:"user-guide/updating_repos",title:"Updating an Iron Bank Repo",description:"This guide will walk you through using IB Manifest to update an Iron Bank",source:"@site/docs/user-guide/updating_repos.md",sourceDirName:"user-guide",slug:"/user-guide/updating_repos",permalink:"/ib_manifest_util/user-guide/updating_repos",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,sidebar_label:"Updating an Iron Bank Repo"},sidebar:"tutorialSidebar",previous:{title:"User Guide",permalink:"/ib_manifest_util/category/user-guide"},next:{title:"Creating a Dockerfile Template",permalink:"/ib_manifest_util/user-guide/creating_dockerfile_template"}},p={},u=[{value:"Preparing your environment",id:"preparing-your-environment",level:2},{value:"Downloading the Iron Bank repo",id:"downloading-the-iron-bank-repo",level:2},{value:"Make changes to the IB Repo files",id:"make-changes-to-the-ib-repo-files",level:2},{value:"Generate the updated repository files",id:"generate-the-updated-repository-files",level:2},{value:"Running IB Manifest from Python",id:"running-ib-manifest-from-python",level:3},{value:"Running IB Manifest from the command line",id:"running-ib-manifest-from-the-command-line",level:3},{value:"Push the updated files to the Iron Bank repository",id:"push-the-updated-files-to-the-iron-bank-repository",level:2}],s={toc:u};function d(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,o.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"updating-an-iron-bank-repo"},"Updating an Iron Bank Repo"),(0,r.kt)("p",null,"This guide will walk you through using ",(0,r.kt)("inlineCode",{parentName:"p"},"IB Manifest")," to update an Iron Bank\nRepository (IB Repo)."),(0,r.kt)("p",null,"Common usecases for the ",(0,r.kt)("inlineCode",{parentName:"p"},"IB Manifest")," are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Adding/Removing a package in ",(0,r.kt)("inlineCode",{parentName:"li"},"local_channel_env.yaml")),(0,r.kt)("li",{parentName:"ul"},"Bringing all the packages in the IB Repo up-to-date")),(0,r.kt)("h2",{id:"preparing-your-environment"},"Preparing your environment"),(0,r.kt)("p",null,"If you haven't already, get your local environment set up by following the\n",(0,r.kt)("a",{parentName:"p",href:"/getting-started/installation"},"Installation guide"),"."),(0,r.kt)("h2",{id:"downloading-the-iron-bank-repo"},"Downloading the Iron Bank repo"),(0,r.kt)("p",null,"You'll need to download a copy of the\n",(0,r.kt)("a",{parentName:"p",href:"https://repo1.dso.mil/dsop"},"Iron Bank Repo"),' you wish to update. You could go\nto the IB Repo and click the "Download" button to get a compressed copy of the\nrepo. However, we recommend using ',(0,r.kt)("inlineCode",{parentName:"p"},"git")," to create a clone of the repo."),(0,r.kt)("p",null,"From your local terminal, clone the repo:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://repo1.dso.mil/dsop/opensource/<your_org>/<your_repo>.git\n")),(0,r.kt)("p",null,"Take note of the location of the repo, this is now what we'll call the\nvariable ",(0,r.kt)("inlineCode",{parentName:"p"},"repo_dir"),"."),(0,r.kt)("h2",{id:"make-changes-to-the-ib-repo-files"},"Make changes to the IB Repo files"),(0,r.kt)("p",null,"At this point, you should make the changes you'd like to see to your local\nrepo files. You may need to add or removed packages in ",(0,r.kt)("inlineCode",{parentName:"p"},"local_channel_env.yaml"),"\nor you may simply be updating the current channel with the most up-to-date\npackages."),(0,r.kt)("h2",{id:"generate-the-updated-repository-files"},"Generate the updated repository files"),(0,r.kt)("p",null,"Finally, we get to run ",(0,r.kt)("inlineCode",{parentName:"p"},"IB Manifest"),"!"),(0,r.kt)("p",null,"There are a couple of options for running\n",(0,r.kt)("inlineCode",{parentName:"p"},"IB Manifest"),". You can choose to run it from Python or from the CLI."),(0,r.kt)("h3",{id:"running-ib-manifest-from-python"},"Running IB Manifest from Python"),(0,r.kt)("p",null,"You can run the IB Manifest ",(0,r.kt)("inlineCode",{parentName:"p"},"update_repo")," function from Python by writing a\nsmall python script. First, let's look at the simplest possible call, then\nwe'll add in more details."),(0,r.kt)("p",null,"Create a new file ",(0,r.kt)("inlineCode",{parentName:"p"},"simple_example.py")," with the following contents:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"from ib_manifest_util.update_repository import update_repo\n\nrepo_dir = 'path/to/repo_dir'\nib_repo_tag = '9999'\n\nupdate_repo(\n    repo_dir=repo_dir,\n    dockerfile_version=ib_repo_tag,\n)\n")),(0,r.kt)("p",null,"Where ",(0,r.kt)("inlineCode",{parentName:"p"},"repo_dir")," is the location of your downloaded copy of the IB Repo and\n",(0,r.kt)("inlineCode",{parentName:"p"},"ib_repo_tag")," is the tag, or version number, of the Dockerfile and the hardening\nmanifest in your repo (you may want to increment this to signify a change)."),(0,r.kt)("p",null,"Then from the command line (with your IB Manifest conda environment activated),\nrun:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"python simple_example.py\n")),(0,r.kt)("p",null,"An similar example script can be found in the IB Manifest repo."),(0,r.kt)("details",null,(0,r.kt)("summary",null," Click here for an example that avoids overwriting IB repository files"),(0,r.kt)("p",null,"The following is an example script for running the ",(0,r.kt)("inlineCode",{parentName:"p"},"update_repo"),' function while\noutputting to a new directory ("/example_output").'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from pathlib import Path\n\nfrom ib_manifest_util.update_repository import update_repo\n\nrepo_dir = \'path/to/repo_dir\'\noutput_dir = Path(".").joinpath("example_output")\n\nupdate_repo(\n    repo_dir=repo_dir,\n    dockerfile_version="9999",\n    local_env_path=repo_dir.joinpath("scripts", "local_channel_env.yaml"),\n    output_hardening_path=output_dir.joinpath("output_hardening_manifest.yaml"),\n    output_dockerfile_path=output_dir.joinpath("output_dockerfile"),\n    dockerfile_template_path=None,\n)\n'))),(0,r.kt)("h3",{id:"running-ib-manifest-from-the-command-line"},"Running IB Manifest from the command line"),(0,r.kt)("p",null,"IB Manifest also includes a command line interface (CLI)."),(0,r.kt)("h2",{id:"push-the-updated-files-to-the-iron-bank-repository"},"Push the updated files to the Iron Bank repository"),(0,r.kt)("p",null,"Now that you've updated all of the required files, you'll need to manually\ncommit these files back to the Iron Bank repo."),(0,r.kt)("p",null,"Once that's complete, you're done \ud83c\udf89"))}d.isMDXComponent=!0}}]);