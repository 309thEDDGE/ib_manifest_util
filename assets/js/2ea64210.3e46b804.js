"use strict";(self.webpackChunkclassic=self.webpackChunkclassic||[]).push([[893],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var a=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},u=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},h=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),h=s(t),m=o,c=h["".concat(p,".").concat(m)]||h[m]||d[m]||i;return t?a.createElement(c,r(r({ref:n},u),{},{components:t})):a.createElement(c,r({ref:n},u))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,r=new Array(i);r[0]=h;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var s=2;s<i;s++)r[s]=t[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}h.displayName="MDXCreateElement"},2038:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var a=t(7462),o=(t(7294),t(3905));const i={sidebar_position:1,sidebar_label:"Updating an Iron Bank Repo"},r="Updating an Iron Bank Repo",l={unversionedId:"user-guide/updating_repos",id:"user-guide/updating_repos",title:"Updating an Iron Bank Repo",description:"This guide will walk you through using IB Manifest to update an Iron Bank",source:"@site/docs/user-guide/updating_repos.md",sourceDirName:"user-guide",slug:"/user-guide/updating_repos",permalink:"/ib_manifest_util/user-guide/updating_repos",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,sidebar_label:"Updating an Iron Bank Repo"},sidebar:"tutorialSidebar",previous:{title:"IB Manifest Basics",permalink:"/ib_manifest_util/user-guide/basics"},next:{title:"Creating a Dockerfile Template",permalink:"/ib_manifest_util/user-guide/creating_dockerfile_template"}},p={},s=[{value:"Preparing your environment",id:"preparing-your-environment",level:2},{value:"Downloading the Iron Bank repo",id:"downloading-the-iron-bank-repo",level:2},{value:"Make changes to the IB Repo files",id:"make-changes-to-the-ib-repo-files",level:2},{value:"Generate the updated repository files",id:"generate-the-updated-repository-files",level:2},{value:"Running IB Manifest from Python",id:"running-ib-manifest-from-python",level:3},{value:"Running IB Manifest from the command line",id:"running-ib-manifest-from-the-command-line",level:3},{value:"Push the updated files to the Iron Bank repository",id:"push-the-updated-files-to-the-iron-bank-repository",level:2}],u={toc:s};function d(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"updating-an-iron-bank-repo"},"Updating an Iron Bank Repo"),(0,o.kt)("p",null,"This guide will walk you through using ",(0,o.kt)("inlineCode",{parentName:"p"},"IB Manifest")," to update an Iron Bank\nRepository (IB Repo)."),(0,o.kt)("p",null,"Common usecases for the ",(0,o.kt)("inlineCode",{parentName:"p"},"IB Manifest")," are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Adding/Removing a package in ",(0,o.kt)("inlineCode",{parentName:"li"},"local_channel_env.yaml")),(0,o.kt)("li",{parentName:"ul"},"Bringing all the packages in the IB Repo up-to-date")),(0,o.kt)("h2",{id:"preparing-your-environment"},"Preparing your environment"),(0,o.kt)("p",null,"If you haven't already, get your local environment set up by following the\n",(0,o.kt)("a",{parentName:"p",href:"/getting-started/installation"},"Installation guide"),"."),(0,o.kt)("h2",{id:"downloading-the-iron-bank-repo"},"Downloading the Iron Bank repo"),(0,o.kt)("p",null,"You'll need to download a copy of the\n",(0,o.kt)("a",{parentName:"p",href:"https://repo1.dso.mil/dsop"},"Iron Bank Repo"),' you wish to update. You could go\nto the IB Repo and click the "Download" button to get a compressed copy of the\nrepo. However, we recommend using ',(0,o.kt)("inlineCode",{parentName:"p"},"git")," to create a clone of the repo."),(0,o.kt)("p",null,"From your local terminal, clone the repo:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://repo1.dso.mil/dsop/opensource/<your_org>/<your_repo>.git\n")),(0,o.kt)("p",null,"Take note of the location of the repo, this is now what we'll call the\nvariable ",(0,o.kt)("inlineCode",{parentName:"p"},"repo_dir"),"."),(0,o.kt)("h2",{id:"make-changes-to-the-ib-repo-files"},"Make changes to the IB Repo files"),(0,o.kt)("p",null,"At this point, you should make the changes you'd like to see to your local\nrepo files. You may need to add or removed packages in ",(0,o.kt)("inlineCode",{parentName:"p"},"local_channel_env.yaml"),"\nor you may simply be updating the current channel with the most up-to-date\npackages."),(0,o.kt)("h2",{id:"generate-the-updated-repository-files"},"Generate the updated repository files"),(0,o.kt)("p",null,"Finally, we get to run ",(0,o.kt)("inlineCode",{parentName:"p"},"IB Manifest"),"!"),(0,o.kt)("p",null,"There are a couple of options for running\n",(0,o.kt)("inlineCode",{parentName:"p"},"IB Manifest"),". You can choose to run it from Python or from the CLI."),(0,o.kt)("h3",{id:"running-ib-manifest-from-python"},"Running IB Manifest from Python"),(0,o.kt)("p",null,"You can run the IB Manifest ",(0,o.kt)("inlineCode",{parentName:"p"},"update_repo")," function from Python by writing a\nsmall python script. First, let's look at the simplest possible call, then\nwe'll add in more details."),(0,o.kt)("p",null,"Create a new file ",(0,o.kt)("inlineCode",{parentName:"p"},"simple_example.py")," with the following contents:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"from ib_manifest_util.update_repository import update_repo\n\nrepo_dir = 'path/to/repo_dir'\nib_repo_tag = '9999'\n\nupdate_repo(\n    repo_dir=repo_dir,\n    dockerfile_version=ib_repo_tag,\n)\n")),(0,o.kt)("p",null,"Where ",(0,o.kt)("inlineCode",{parentName:"p"},"repo_dir")," is the location of your downloaded copy of the IB Repo and\n",(0,o.kt)("inlineCode",{parentName:"p"},"ib_repo_tag")," is the tag, or version number, of the Dockerfile and the hardening\nmanifest in your repo (you may want to increment this to signify a change)."),(0,o.kt)("p",null,"Then from the command line (with your IB Manifest conda environment activated),\nrun:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"python simple_example.py\n")),(0,o.kt)("p",null,"An similar example script can be found in the IB Manifest repo."),(0,o.kt)("details",null,(0,o.kt)("summary",null," Click here for an example that avoids overwriting IB repository files"),(0,o.kt)("p",null,"The following is an example script for running the ",(0,o.kt)("inlineCode",{parentName:"p"},"update_repo"),' function while\noutputting to a new directory ("/example_output").'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'from pathlib import Path\n\nfrom ib_manifest_util.update_repository import update_repo\n\nrepo_dir = \'path/to/repo_dir\'\noutput_dir = Path(".").joinpath("example_output")\n\nupdate_repo(\n    repo_dir=repo_dir,\n    dockerfile_version="9999",\n    local_env_path=repo_dir.joinpath("scripts", "local_channel_env.yaml"),\n    output_hardening_path=output_dir.joinpath("output_hardening_manifest.yaml"),\n    output_dockerfile_path=output_dir.joinpath("output_dockerfile"),\n    dockerfile_template_path=None,\n)\n'))),(0,o.kt)("h3",{id:"running-ib-manifest-from-the-command-line"},"Running IB Manifest from the command line"),(0,o.kt)("p",null,"To get started, ensure that you have the ",(0,o.kt)("inlineCode",{parentName:"p"},"ib_manifest_util")," package installed. To verify, run the following command from your terminal:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ ib_manifest_util --version\nib_manifest_util, version 0.1.0\n")),(0,o.kt)("p",null,"And for help:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ ib_manifest_util --help\n\nUsage: ib_manifest_util [OPTIONS] COMMAND [ARGS]...\n\n  To display help and usage for subcommands, use: ib_manifest_util [COMMAND]\n  --help\n\nOptions:\n  --version  Show the version and exit.\n  --help     Show this message and exit.\n\nCommands:\n  download_packages  Download necessary Python packages given an Iron...\n  update_repo        Update the local hardening manifest and Dockerfile...\n")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"If these commands don't work for you, double check you have the package installed. See the ",(0,o.kt)("a",{parentName:"p",href:"/ib_manifest_util/getting-started/installation"},"installation instructions")," for details.")),(0,o.kt)("p",null,"As the help page outlines, there are two high-level commands, ",(0,o.kt)("inlineCode",{parentName:"p"},"download_packages")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"update_repo"),". To make the same changes as ",(0,o.kt)("a",{parentName:"p",href:"/ib_manifest_util/user-guide/updating_repos#running-ib-manifest-from-python"},"above"),",\nwe will use the ",(0,o.kt)("inlineCode",{parentName:"p"},"update_repo")," command. To get a better understanding of how to use it, run the ",(0,o.kt)("inlineCode",{parentName:"p"},"--help")," command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ ib_manifest_util update_repo --help\nUsage: ib_manifest_util update_repo [OPTIONS]\n\n  Update the local hardening manifest and Dockerfile with necessary packages\n  given an environment file\n\nOptions:\n  --repo_dir TEXT\n  --dockerfile_version TEXT\n  --local_env_path TEXT          Path to local environment file\n  --startup_scripts_path TEXT    (Optional) Path to .yaml file containing\n                                 additional files to copy\n  --output_hardening_path TEXT   (Optional) Path to location in which the\n                                 hardening manifest will be placed\n  --output_dockerfile_path TEXT  (Optional) Path to location in which the\n                                 Dockerfile will be placed\n  --help                         Show this message and exit.\n")),(0,o.kt)("p",null,"Assuming the Iron Bank repository has been cloned locally and the repo has a ",(0,o.kt)("inlineCode",{parentName:"p"},"Dockerfile.tpl"),", then running the following command will update the two ",(0,o.kt)("inlineCode",{parentName:"p"},"repodata.json"),", the ",(0,o.kt)("inlineCode",{parentName:"p"},"Dockerfile")," and the ",(0,o.kt)("inlineCode",{parentName:"p"},"hardening_manifest.yaml"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"ib_manifest_util update_repo --repo_dir ~/path/to/ib-repo --dockerfile_version 9999\n")),(0,o.kt)("p",null,"The last step is to review the new files and push them back to the Iron Bank repo."),(0,o.kt)("h2",{id:"push-the-updated-files-to-the-iron-bank-repository"},"Push the updated files to the Iron Bank repository"),(0,o.kt)("p",null,"Now that you've updated all of the required files, you'll need to manually\ncommit these files back to the Iron Bank repo."),(0,o.kt)("p",null,"Once that's complete, you're done \ud83c\udf89"))}d.isMDXComponent=!0}}]);